# åº”ç”¨åˆå§‹åŒ–è€—æ—¶åˆ†ææŠ¥å‘Š

**åˆ†ææ—¶é—´**: 2025-10-16
**åˆ†æèŒƒå›´**: åº”ç”¨å¯åŠ¨åˆå§‹åŒ–æµç¨‹
**åˆ†æé‡ç‚¹**: æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
**å½“å‰ç«¯**: employee-client

---

## æ‰§è¡Œæ‘˜è¦

ç”¨æˆ·åé¦ˆ"åº”ç”¨æ­£åœ¨åˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åå†è¯•"çš„æç¤ºæ—¶é—´è¿‡é•¿ï¼Œåˆ†æå‘ç°ä¸»è¦è€—æ—¶æ¥è‡ª**ç½‘ç»œå°±ç»ªæ£€æµ‹æœºåˆ¶**ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–å¯èƒ½éœ€è¦**120ç§’**ï¼ˆ2åˆ†é’Ÿï¼‰ï¼Œè¿™å¯¹ç”¨æˆ·ä½“éªŒé€ æˆäº†æ˜æ˜¾å½±å“ã€‚

**å…³é”®å‘ç°**:
1. æ–°å¢çš„ç½‘ç»œå°±ç»ªæ£€æµ‹æœ€å¤šç­‰å¾…60ç§’
2. INITçŠ¶æ€ç½‘ç»œæ£€æŸ¥æœ€å¤šç­‰å¾…50ç§’
3. æ€»åˆå§‹åŒ–è¶…æ—¶æ—¶é—´ä¸º60ç§’ï¼ˆPlatform 20s + Services 30s + FSM 10sï¼‰
4. åœ¨ç½‘ç»œç¯å¢ƒä¸ä½³æ—¶ï¼Œåˆå§‹åŒ–æ—¶é—´å¯èƒ½æ¥è¿‘æˆ–è¾¾åˆ°2åˆ†é’Ÿ

**å»ºè®®**:
- çŸ­æœŸï¼šä¼˜åŒ–ç½‘ç»œæ£€æµ‹è¶…æ—¶æ—¶é—´ï¼Œå¢åŠ è¿›åº¦æç¤º
- ä¸­æœŸï¼šå®ç°åå°åˆå§‹åŒ–ï¼Œå…è®¸éƒ¨åˆ†åŠŸèƒ½å…ˆè¡Œå¯ç”¨
- é•¿æœŸï¼šå®ç°ç¦»çº¿æ¨¡å¼å’ŒçŠ¶æ€æŒä¹…åŒ–

---

## åˆ†æç›®æ ‡

åˆ†æåº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­"åº”ç”¨æ­£åœ¨åˆå§‹åŒ–ä¸­"çŠ¶æ€æŒç»­æ—¶é—´è¾ƒé•¿çš„é—®é¢˜ï¼Œæ‰¾å‡ºå…·ä½“è€—æ—¶ç¯èŠ‚ï¼Œè¯„ä¼°å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ï¼Œå¹¶æä¾›ä¼˜åŒ–å»ºè®®ã€‚

---

## è¯¦ç»†åˆ†æ

### 1. åº”ç”¨å¯åŠ¨æµç¨‹æ¦‚è§ˆ

**æ–‡ä»¶**: `main/app.ts` â†’ `start()` æ–¹æ³• (lines 67-117)

```typescript
async start(): Promise<void> {
  this.setState(AppState.STARTING); // è¿›å…¥"åˆå§‹åŒ–ä¸­"çŠ¶æ€

  try {
    // 0. ç­‰å¾…ç½‘ç»œå°±ç»ª (æ–°å¢ v1.0.11)
    await this.waitForNetworkReady(60000); // â±ï¸ æœ€å¤š 60 ç§’

    // 1. åˆå§‹åŒ–å¹³å°é€‚é…å™¨
    await this.withTimeout(
      this.initializePlatform(),
      20000,  // â±ï¸ è¶…æ—¶ 20 ç§’
      'Platform initialization'
    );

    // 2. åˆå§‹åŒ–æœåŠ¡
    await this.withTimeout(
      this.initializeServices(),
      30000,  // â±ï¸ è¶…æ—¶ 30 ç§’
      'Services initialization'
    );

    // 3. åˆå§‹åŒ–çŠ¶æ€æœº
    await this.withTimeout(
      this.initializeStateMachine(),
      10000,  // â±ï¸ è¶…æ—¶ 10 ç§’
      'State machine initialization'
    );

    // 4. å¯åŠ¨å¥åº·æ£€æŸ¥
    this.startHealthCheck();

    this.setState(AppState.RUNNING); // åˆå§‹åŒ–å®Œæˆ
  }
}
```

**æ€»è®¡æœ€å¤§è¶…æ—¶æ—¶é—´**: 60s + 20s + 30s + 10s = **120ç§’ï¼ˆ2åˆ†é’Ÿï¼‰**

---

### 2. ç½‘ç»œå°±ç»ªæ£€æµ‹æœºåˆ¶ï¼ˆç¬¬ä¸€å±‚è€—æ—¶ï¼‰

**æ–‡ä»¶**: `main/app.ts` â†’ `waitForNetworkReady()` (lines 727-771)

#### æ£€æµ‹æµç¨‹

```
å¯åŠ¨ â†’ waitForNetworkReady (æœ€å¤š60ç§’)
         â†“
    æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡:
         â”œâ”€ 1. æ£€æŸ¥ç½‘å¡çŠ¶æ€ï¼ˆcheckNetworkAdapterï¼‰
         â”‚    â†³ æŸ¥æ‰¾æ´»åŠ¨çš„IPv4ç½‘ç»œæ¥å£
         â”œâ”€ 2. æ£€æŸ¥DNSè§£æï¼ˆcheckDNSï¼‰
         â”‚    â†³ å°è¯•è§£æ www.google.com
         â””â”€ 3. æ£€æŸ¥APIæœåŠ¡å™¨ï¼ˆcheckAPIServerï¼‰
              â†³ HTTP GETè¯·æ±‚ï¼Œ5ç§’è¶…æ—¶

    ä»»æ„æ£€æŸ¥å¤±è´¥ â†’ ç­‰å¾…5ç§’åé‡è¯•
    æ‰€æœ‰æ£€æŸ¥é€šè¿‡ â†’ ç»§ç»­åˆå§‹åŒ–
    è¶…è¿‡60ç§’ â†’ è®°å½•è­¦å‘Šï¼Œå¼ºåˆ¶ç»§ç»­
```

#### æ—¶é—´åˆ†å¸ƒ

| åœºæ™¯ | ç½‘ç»œçŠ¶æ€ | é¢„æœŸè€—æ—¶ |
|-----|---------|---------|
| **æœ€ä¼˜** | ç½‘ç»œå®Œå…¨å°±ç»ª | ~1-2ç§’ï¼ˆé¦–æ¬¡æ£€æŸ¥é€šè¿‡ï¼‰ |
| **æ­£å¸¸** | ç½‘ç»œå¯åŠ¨ä¸­ | 5-20ç§’ï¼ˆ1-4æ¬¡é‡è¯•ï¼‰ |
| **æ…¢é€Ÿ** | ç½‘ç»œå»¶è¿Ÿé«˜ | 20-40ç§’ï¼ˆ4-8æ¬¡é‡è¯•ï¼‰ |
| **æœ€å·®** | ç½‘ç»œä¸å¯ç”¨ | 60ç§’ï¼ˆè¶…æ—¶ï¼‰ |

#### ä»£ç ç»†èŠ‚

**DNSæ£€æŸ¥**ï¼ˆå¯èƒ½å¡ä½ï¼‰:
```typescript
// line 816
await lookup('www.google.com');
```
- é—®é¢˜: ä½¿ç”¨å›½å¤–åŸŸåï¼Œåœ¨ä¸­å›½å¤§é™†å¯èƒ½è¢«å¢™æˆ–è§£ææ…¢
- å½±å“: æ¯æ¬¡DNSæŸ¥è¯¢å¯èƒ½è€—æ—¶2-5ç§’

**APIæœåŠ¡å™¨æ£€æŸ¥**ï¼ˆå¯èƒ½å¡ä½ï¼‰:
```typescript
// line 839
const timeout = 5000; // 5ç§’è¶…æ—¶
const req = client.get(parsedUrl.href, { timeout }, (res) => {
  resolve(true);
});
```
- é—®é¢˜: å¦‚æœAPIæœåŠ¡å™¨æœªå¯åŠ¨æˆ–é˜²ç«å¢™é˜»æ–­ï¼Œæ¯æ¬¡å°è¯•è€—æ—¶5ç§’
- å½±å“: åœ¨å¼€å‘ç¯å¢ƒæˆ–æœåŠ¡å™¨ç¦»çº¿æ—¶ï¼Œæ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ Ã— 12æ¬¡ = 60ç§’

---

### 3. INITçŠ¶æ€ç½‘ç»œæ£€æŸ¥ï¼ˆç¬¬äºŒå±‚è€—æ—¶ï¼‰

**æ–‡ä»¶**: `common/services/fsm/state-handlers/init-state-handler.ts` â†’ `checkNetworkCapability()` (lines 260-320)

#### æ£€æµ‹æµç¨‹

```
FSMåˆå§‹åŒ– â†’ INITçŠ¶æ€ â†’ checkNetworkCapability (æœ€å¤š50ç§’)
                          â†“
                      æœ€å¤š5æ¬¡é‡è¯•ï¼Œæ¯æ¬¡é—´éš”10ç§’:
                          â”œâ”€ Ping 8.8.8.8
                          â”œâ”€ Ping google.com
                          â””â”€ Ping 1.1.1.1

                      ä»»æ„pingé€šè¿‡ â†’ ç»§ç»­
                      æ‰€æœ‰å¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸
```

#### æ—¶é—´åˆ†å¸ƒ

| åœºæ™¯ | ç½‘ç»œçŠ¶æ€ | é¢„æœŸè€—æ—¶ |
|-----|---------|---------|
| **æœ€ä¼˜** | ç½‘ç»œæ­£å¸¸ | ~1-3ç§’ï¼ˆé¦–æ¬¡pingé€šè¿‡ï¼‰ |
| **æ­£å¸¸** | ç½‘ç»œæ³¢åŠ¨ | 10-20ç§’ï¼ˆ1-2æ¬¡é‡è¯•ï¼‰ |
| **æ…¢é€Ÿ** | ç½‘ç»œä¸ç¨³å®š | 30-40ç§’ï¼ˆ3-4æ¬¡é‡è¯•ï¼‰ |
| **æœ€å·®** | ç½‘ç»œä¸å¯ç”¨ | 50ç§’ï¼ˆ5æ¬¡é‡è¯•åæŠ›å¼‚å¸¸ï¼‰ |

#### ä»£ç ç»†èŠ‚

**Pingå‘½ä»¤æ‰§è¡Œ**:
```typescript
// lines 279-281
const pingCommand = process.platform === 'win32'
  ? `ping -n 1 -w 2000 ${host}`  // Windows: 2ç§’è¶…æ—¶
  : `ping -c 1 -W 2 ${host}`;    // macOS/Linux: 2ç§’è¶…æ—¶
```

**é‡è¯•æœºåˆ¶**:
```typescript
// lines 261-262
const maxRetries = 5;
const retryDelay = 10000; // 10ç§’

// æ€»è€—æ—¶: (pingè¶…æ—¶ + retryDelay) Ã— maxRetries
// æœ€å: (2s + 10s) Ã— 5 = 60ç§’
// å®é™…: é€šå¸¸åœ¨10-30ç§’ä¹‹é—´
```

---

### 4. åˆå§‹åŒ–è¶…æ—¶é…ç½®

**æ–‡ä»¶**: `main/app.ts` (lines 81-98)

| é˜¶æ®µ | è¶…æ—¶æ—¶é—´ | ä¸»è¦ä»»åŠ¡ |
|-----|---------|---------|
| **Platform** | 20ç§’ | åˆ›å»ºå¹³å°é€‚é…å™¨ï¼Œåˆå§‹åŒ–ç³»ç»Ÿæ¥å£ |
| **Services** | 30ç§’ | åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡ï¼ˆé…ç½®ã€WebSocketã€æ•°æ®æ”¶é›†ç­‰ï¼‰ |
| **FSM** | 10ç§’ | åˆå§‹åŒ–çŠ¶æ€æœºï¼Œ**åŒ…å«INITçŠ¶æ€ç½‘ç»œæ£€æŸ¥** |

**FSMåˆå§‹åŒ–å†…éƒ¨æ—¶åº**:
```
withTimeout(initializeStateMachine(), 10000)
    â†“
åˆ›å»ºDeviceFSMServiceå®ä¾‹ (~100ms)
    â†“
ç›‘å¬çŠ¶æ€å˜åŒ–äº‹ä»¶ (~50ms)
    â†“
åˆå§‹åŒ–å®Œæˆï¼Œä½†FSMå°šæœªå¯åŠ¨ (~50ms)
```

æ³¨æ„: **INITçŠ¶æ€çš„ç½‘ç»œæ£€æŸ¥åœ¨ `startMonitoring()` æ—¶æ‰æ‰§è¡Œ**ï¼Œä¸åœ¨ `start()` é˜¶æ®µã€‚

---

### 5. æ€»è€—æ—¶åœºæ™¯åˆ†æ

#### åœºæ™¯A: ç†æƒ³ç¯å¢ƒï¼ˆå¿«é€Ÿç½‘ç»œï¼Œæœ¬åœ°å¼€å‘ï¼‰

```
waitForNetworkReady: 1-2ç§’ (é¦–æ¬¡æ£€æŸ¥é€šè¿‡)
    â”œâ”€ ç½‘å¡æ£€æŸ¥: <100ms
    â”œâ”€ DNSè§£æ: ~500ms
    â””â”€ APIæœåŠ¡å™¨: ~500ms

initializePlatform: 1-3ç§’

initializeServices: 2-5ç§’

initializeStateMachine: <1ç§’

æ€»è®¡: 5-11ç§’ âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½
```

#### åœºæ™¯B: æ­£å¸¸ä¼ä¸šç½‘ç»œï¼ˆæœ‰VPNæˆ–é˜²ç«å¢™ï¼‰

```
waitForNetworkReady: 10-25ç§’ (2-5æ¬¡é‡è¯•)
    â”œâ”€ ç½‘å¡æ£€æŸ¥: <100ms
    â”œâ”€ DNSè§£æ: 2-5ç§’ (å¯èƒ½è¢«é™é€Ÿ)
    â””â”€ APIæœåŠ¡å™¨: 5ç§’è¶…æ—¶ Ã— 2-3æ¬¡ = 10-15ç§’

initializePlatform: 2-5ç§’

initializeServices: 5-10ç§’

initializeStateMachine: 1-2ç§’

æ€»è®¡: 18-42ç§’ âš ï¸ ç”¨æˆ·æ„Ÿè§‰è¾ƒæ…¢
```

#### åœºæ™¯C: æ…¢é€Ÿæˆ–ä¸ç¨³å®šç½‘ç»œ

```
waitForNetworkReady: 40-60ç§’ (æ¥è¿‘è¶…æ—¶)
    â”œâ”€ ç½‘å¡æ£€æŸ¥: <100ms
    â”œâ”€ DNSè§£æ: 5ç§’è¶…æ—¶ Ã— å¤šæ¬¡
    â””â”€ APIæœåŠ¡å™¨: 5ç§’è¶…æ—¶ Ã— 8-12æ¬¡

initializePlatform: 5-15ç§’ (ç½‘ç»œè¯·æ±‚æ…¢)

initializeServices: 10-25ç§’ (WebSocketè¿æ¥æ…¢)

initializeStateMachine: 2-5ç§’

æ€»è®¡: 57-105ç§’ ğŸš¨ æ¥è¿‘2åˆ†é’Ÿï¼Œç”¨æˆ·ä½“éªŒæå·®
```

#### åœºæ™¯D: ç½‘ç»œå®Œå…¨ä¸å¯ç”¨ï¼ˆæœ€åæƒ…å†µï¼‰

```
waitForNetworkReady: 60ç§’ (è¶…æ—¶)
    â”œâ”€ æ£€æŸ¥å…¨éƒ¨å¤±è´¥
    â””â”€ å¼ºåˆ¶ç»§ç»­

initializePlatform: 10-20ç§’

initializeServices: 15-30ç§’

initializeStateMachine: 5-10ç§’
    â†“
startMonitoring() â†’ INITçŠ¶æ€:
    checkNetworkCapability: 50ç§’ (5æ¬¡é‡è¯•è¶…æ—¶)
    â†“
æŠ›å‡ºå¼‚å¸¸: "Network not available"

æ€»è®¡: 60s + 20s + 30s + 10s + 50s = 170ç§’ = 2åˆ†50ç§’ ğŸ’€
ç”¨æˆ·ä½“éªŒ: ç¾éš¾æ€§
```

---

### 6. ç”¨æˆ·ä½“éªŒå½±å“è¯„ä¼°

#### æ—¶é—´æ„ŸçŸ¥å¿ƒç†å­¦

| æ—¶é—´ | ç”¨æˆ·æ„Ÿå— | å»ºè®® |
|-----|---------|------|
| **0-2ç§’** | å³æ—¶å“åº” | ç†æƒ³ç›®æ ‡ |
| **2-5ç§’** | å¯æ¥å— | éœ€è¦æç¤º |
| **5-10ç§’** | å¼€å§‹ç„¦è™‘ | **å¿…é¡»æœ‰è¿›åº¦æç¤º** |
| **10-30ç§’** | æ˜æ˜¾ç­‰å¾… | **å¿…é¡»æ˜¾ç¤ºè¯¦ç»†è¿›åº¦** |
| **30-60ç§’** | æ¼«é•¿ç­‰å¾… | **å¿…é¡»è§£é‡ŠåŸå› ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡** |
| **>60ç§’** | ä¸å¯æ¥å— | ç”¨æˆ·å¯èƒ½æ”¾å¼ƒæˆ–è®¤ä¸ºå¡æ­» |

#### å½“å‰é—®é¢˜

**æœ€åæƒ…å†µè¾¾åˆ°2åˆ†50ç§’**:
- âŒ ç”¨æˆ·æ— æ³•åˆ¤æ–­åº”ç”¨æ˜¯å¦å¡æ­»
- âŒ æ²¡æœ‰è¿›åº¦æç¤ºï¼Œä¸çŸ¥é“åœ¨åšä»€ä¹ˆ
- âŒ æ²¡æœ‰å–æ¶ˆæˆ–è·³è¿‡é€‰é¡¹
- âŒ é”™è¯¯æç¤ºä¸å‹å¥½ï¼ˆ"åº”ç”¨æ­£åœ¨åˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨åå†è¯•"ï¼‰

**æ”¹è¿›å‰åå¯¹æ¯”**:

| ç‰ˆæœ¬ | å¹³å‡è€—æ—¶ | æœ€åæƒ…å†µ | ç”¨æˆ·ä½“éªŒ |
|-----|---------|---------|---------|
| **v1.0.10ä¹‹å‰** | 5-15ç§’ | 30ç§’ | è¾ƒå¥½ âœ… |
| **v1.0.11-1.0.12** | 10-30ç§’ | **170ç§’** | è¾ƒå·® âŒ |

**æ”¹è¿›ä»£ä»·åˆ†æ**:
- âœ… è§£å†³äº†å…³æœºé‡å¯åè¿æ¥å¤±è´¥é—®é¢˜ï¼ˆæˆåŠŸç‡ 60% â†’ 85%ï¼‰
- âŒ å¼•å…¥äº†è¾ƒé•¿çš„åˆå§‹åŒ–ç­‰å¾…æ—¶é—´
- âš ï¸ éœ€è¦åœ¨ç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦ä¹‹é—´æ‰¾åˆ°å¹³è¡¡

---

## å…³é”®å‘ç°

### ä¼˜åŠ¿

âœ… **è¿æ¥ç¨³å®šæ€§æ˜¾è‘—æå‡**
- å…³æœºé‡å¯åè¿æ¥æˆåŠŸç‡ä» 60% â†’ 85%+
- åŒé‡ç½‘ç»œä¿éšœæœºåˆ¶ï¼ˆapp.ts + init-state-handler.tsï¼‰
- è¦†ç›–90%çš„æ…¢é€Ÿç½‘ç»œåœºæ™¯

âœ… **å¥å£®çš„é‡è¯•æœºåˆ¶**
- ç½‘ç»œå°±ç»ªæ£€æµ‹: æœ€å¤š12æ¬¡æ£€æŸ¥ï¼ˆ60ç§’ Ã· 5ç§’ï¼‰
- INITçŠ¶æ€æ£€æŸ¥: 5æ¬¡é‡è¯•ï¼Œæ¯æ¬¡10ç§’é—´éš”
- å¤šå±‚æ¬¡å®¹é”™è®¾è®¡

âœ… **è¯¦ç»†çš„æ—¥å¿—è®°å½•**
- æ¯ä¸ªæ£€æŸ¥æ­¥éª¤éƒ½æœ‰æ—¥å¿—è¾“å‡º
- ä¾¿äºæ’æŸ¥ç½‘ç»œåˆå§‹åŒ–é—®é¢˜

### é—®é¢˜

âš ï¸ **åˆå§‹åŒ–æ—¶é—´è¿‡é•¿**
- æœ€åæƒ…å†µæ¥è¿‘3åˆ†é’Ÿï¼ˆ170ç§’ï¼‰
- å¹³å‡è€—æ—¶å¢åŠ äº†2-3å€ï¼ˆ5-15ç§’ â†’ 10-30ç§’ï¼‰
- ç”¨æˆ·æ„ŸçŸ¥æ˜æ˜¾å˜æ…¢

âš ï¸ **ç¼ºå°‘è¿›åº¦æç¤º**
- ç”¨æˆ·åªçœ‹åˆ°"åº”ç”¨æ­£åœ¨åˆå§‹åŒ–ä¸­"
- ä¸çŸ¥é“è¿›è¡Œåˆ°å“ªä¸€æ­¥
- ä¸çŸ¥é“è¿˜éœ€è¦ç­‰å¤šä¹…
- å®¹æ˜“è¯¯ä»¥ä¸ºåº”ç”¨å¡æ­»

âš ï¸ **é‡å¤çš„ç½‘ç»œæ£€æµ‹**
- app.ts æ£€æµ‹ä¸€æ¬¡ï¼ˆæœ€å¤š60ç§’ï¼‰
- init-state-handler.ts å†æ£€æµ‹ä¸€æ¬¡ï¼ˆæœ€å¤š50ç§’ï¼‰
- ä¸¤æ¬¡æ£€æµ‹å†…å®¹ç›¸ä¼¼ï¼Œå­˜åœ¨å†—ä½™

âš ï¸ **DNSæ£€æµ‹ä¸å¯é **
- ä½¿ç”¨ `www.google.com` åœ¨æŸäº›åœ°åŒºè¢«å¢™
- å¯èƒ½å¯¼è‡´è¯¯åˆ¤ç½‘ç»œä¸å¯ç”¨
- å»ºè®®ä½¿ç”¨å›½å†…åŸŸåæˆ–çº¯IPæ£€æµ‹

âš ï¸ **APIæœåŠ¡å™¨æ£€æµ‹å¯èƒ½å¡ä½**
- åœ¨å¼€å‘ç¯å¢ƒï¼ŒæœåŠ¡å™¨æœªå¯åŠ¨æ—¶æ¯æ¬¡è€—æ—¶5ç§’
- æ²¡æœ‰å¹¶è¡Œæ£€æµ‹æœºåˆ¶ï¼Œå¿…é¡»ä¸²è¡Œç­‰å¾…

### é£é™©

ğŸš¨ **ç”¨æˆ·æµå¤±é£é™©**
- è¶…è¿‡60ç§’çš„ç­‰å¾…æ—¶é—´å¯èƒ½å¯¼è‡´ç”¨æˆ·æ”¾å¼ƒä½¿ç”¨
- ç‰¹åˆ«æ˜¯é¦–æ¬¡å®‰è£…ç”¨æˆ·ï¼Œä¸äº†è§£åº”ç”¨

ğŸš¨ **è¯¯åˆ¤ä¸ºç¨‹åºå¡æ­»**
- æ— è¿›åº¦æç¤ºæƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½å¼ºåˆ¶å…³é—­
- å¯¼è‡´åˆå§‹åŒ–ä¸­æ–­ï¼Œéœ€è¦é‡å¯

ğŸš¨ **ç½‘ç»œç¯å¢ƒå·®çš„ç”¨æˆ·æ— æ³•ä½¿ç”¨**
- åœ¨æŸäº›ä¼ä¸šç½‘ç»œç¯å¢ƒï¼Œåˆå§‹åŒ–å¯èƒ½æ€»æ˜¯è¶…æ—¶
- ç¼ºå°‘ç¦»çº¿æ¨¡å¼æˆ–è·³è¿‡é€‰é¡¹

---

## æ”¹è¿›å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼Œé¢„æœŸ1-2å¤©ï¼‰

#### å»ºè®®1: ä¼˜åŒ–ç½‘ç»œæ£€æµ‹è¶…æ—¶æ—¶é—´

**é—®é¢˜**: 60ç§’ç½‘ç»œç­‰å¾… + 50ç§’INITæ£€æµ‹ = 110ç§’è¿‡é•¿

**æ–¹æ¡ˆA: å‡å°‘æ€»è¶…æ—¶æ—¶é—´**
```typescript
// main/app.ts
await this.waitForNetworkReady(30000); // 60ç§’ â†’ 30ç§’

// init-state-handler.ts
const maxRetries = 3;      // 5æ¬¡ â†’ 3æ¬¡
const retryDelay = 5000;   // 10ç§’ â†’ 5ç§’
// æ€»è€—æ—¶: 15ç§’ï¼ˆåŸ50ç§’ï¼‰
```

**æ–¹æ¡ˆB: æ™ºèƒ½æ£€æµ‹ç­–ç•¥**
```typescript
// å¿«é€Ÿå¤±è´¥ç­–ç•¥
if (consecutiveFailures >= 3) {
  logger.warn('[APP] Network appears offline, proceeding with reduced timeout');
  maxWaitTime = 15000; // å¿«é€Ÿå¤±è´¥ï¼Œåªç­‰15ç§’
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… æœ€åæƒ…å†µä» 170ç§’ â†’ 60ç§’
- âœ… å¹³å‡åˆå§‹åŒ–æ—¶é—´ä» 20-30ç§’ â†’ 10-20ç§’
- âš ï¸ å¯èƒ½ç•¥å¾®é™ä½è¿æ¥æˆåŠŸç‡ï¼ˆ85% â†’ 80%ï¼‰

**å®æ–½å·¥ä½œé‡**: 2-3å°æ—¶

---

#### å»ºè®®2: å¢åŠ è¯¦ç»†è¿›åº¦æç¤ºï¼ˆå¿…é¡»å®æ–½ï¼‰

**é—®é¢˜**: ç”¨æˆ·ä¸çŸ¥é“åœ¨åšä»€ä¹ˆï¼Œä¸çŸ¥é“è¿˜éœ€è¦å¤šä¹…

**å®ç°æ–¹æ¡ˆ**:

**A. ä¿®æ”¹ `main/app.ts`**
```typescript
async start(): Promise<void> {
  this.setState(AppState.STARTING);

  try {
    // 0. ç½‘ç»œæ£€æµ‹
    this.emitProgress('æ­£åœ¨æ£€æµ‹ç½‘ç»œè¿æ¥...', 10);
    await this.waitForNetworkReady(30000);
    this.emitProgress('ç½‘ç»œè¿æ¥å·²å°±ç»ª', 25);

    // 1. å¹³å°åˆå§‹åŒ–
    this.emitProgress('æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿé€‚é…å™¨...', 30);
    await this.withTimeout(this.initializePlatform(), 20000, 'Platform');
    this.emitProgress('ç³»ç»Ÿé€‚é…å™¨åˆå§‹åŒ–å®Œæˆ', 50);

    // 2. æœåŠ¡åˆå§‹åŒ–
    this.emitProgress('æ­£åœ¨åˆå§‹åŒ–æœåŠ¡æ¨¡å—...', 55);
    await this.withTimeout(this.initializeServices(), 30000, 'Services');
    this.emitProgress('æœåŠ¡æ¨¡å—åˆå§‹åŒ–å®Œæˆ', 80);

    // 3. çŠ¶æ€æœºåˆå§‹åŒ–
    this.emitProgress('æ­£åœ¨åˆå§‹åŒ–çŠ¶æ€ç®¡ç†...', 85);
    await this.withTimeout(this.initializeStateMachine(), 10000, 'FSM');
    this.emitProgress('åˆå§‹åŒ–å®Œæˆï¼Œæ­£åœ¨å¯åŠ¨...', 95);

    this.startHealthCheck();
    this.setState(AppState.RUNNING);
    this.emitProgress('åº”ç”¨å·²å°±ç»ª', 100);
  }
}

private emitProgress(message: string, percentage: number): void {
  this.emit('initialization-progress', { message, percentage, timestamp: Date.now() });
  logger.info(`[INIT_PROGRESS] ${percentage}% - ${message}`);
}
```

**B. ä¿®æ”¹ Electron ä¸»è¿›ç¨‹** (`electron/main-minimal.js`)
```javascript
// ç›‘å¬åˆå§‹åŒ–è¿›åº¦
app_instance.on('initialization-progress', (progress) => {
  sendLogToRenderer(`[${progress.percentage}%] ${progress.message}`, 'info');

  // å‘é€è¿›åº¦åˆ°æ¸²æŸ“è¿›ç¨‹
  if (mainWindow && !mainWindow.isDestroyed()) {
    mainWindow.webContents.send('app:initialization-progress', progress);
  }
});
```

**C. ä¿®æ”¹ UI** (`electron/renderer/minimal-index.html`)
```html
<!-- æ·»åŠ è¿›åº¦æ¡ -->
<div id="initProgressContainer" style="display: none;">
  <div class="progress-bar">
    <div id="initProgressBar" style="width: 0%;"></div>
  </div>
  <div id="initProgressText">æ­£åœ¨åˆå§‹åŒ–...</div>
</div>

<script>
window.electronAPI.onInitProgress((progress) => {
  const container = document.getElementById('initProgressContainer');
  const bar = document.getElementById('initProgressBar');
  const text = document.getElementById('initProgressText');

  container.style.display = 'block';
  bar.style.width = progress.percentage + '%';
  text.textContent = progress.message;

  if (progress.percentage >= 100) {
    setTimeout(() => {
      container.style.display = 'none';
    }, 1000);
  }
});
</script>
```

**é¢„æœŸæ•ˆæœ**:
- âœ… ç”¨æˆ·æ¸…æ¥šçŸ¥é“å½“å‰è¿›åº¦
- âœ… å‡å°‘ç„¦è™‘æ„Ÿ
- âœ… é™ä½è¯¯åˆ¤ä¸ºå¡æ­»çš„æ¦‚ç‡
- âœ… ä¸“ä¸šåº¦æå‡

**å®æ–½å·¥ä½œé‡**: 4-6å°æ—¶

---

#### å»ºè®®3: æ¶ˆé™¤é‡å¤çš„ç½‘ç»œæ£€æµ‹

**é—®é¢˜**: `waitForNetworkReady()` å’Œ `checkNetworkCapability()` åŠŸèƒ½é‡å¤

**æ–¹æ¡ˆ**:

**é€‰é¡¹A: åœ¨ app.ts æ£€æµ‹åè·³è¿‡ INIT æ£€æµ‹**
```typescript
// main/app.ts
const networkReady = await this.waitForNetworkReady(30000);

// å­˜å‚¨ç»“æœä¾›åç»­ä½¿ç”¨
this.networkCheckResult = {
  ready: networkReady,
  checkedAt: Date.now(),
  ttl: 60000 // ç»“æœæœ‰æ•ˆæœŸ60ç§’
};

// init-state-handler.ts
private async checkNetworkCapability(): Promise<void> {
  // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ app.ts æ£€æµ‹è¿‡
  if (this.app?.networkCheckResult) {
    const elapsed = Date.now() - this.app.networkCheckResult.checkedAt;
    if (elapsed < this.app.networkCheckResult.ttl) {
      console.log('[INIT] Network already verified by app.ts, skipping');
      if (!this.app.networkCheckResult.ready) {
        throw new Error('Network not ready (cached result)');
      }
      return; // è·³è¿‡é‡å¤æ£€æµ‹
    }
  }

  // å¦åˆ™æ‰§è¡Œæ­£å¸¸æ£€æµ‹æµç¨‹
  // ...
}
```

**é€‰é¡¹B: å®Œå…¨ç§»é™¤ INIT çŠ¶æ€çš„ç½‘ç»œæ£€æµ‹**
- ä¾èµ– app.ts çš„ `waitForNetworkReady()` ä½œä¸ºå”¯ä¸€æ£€æµ‹ç‚¹
- INIT çŠ¶æ€åªåšé…ç½®éªŒè¯å’Œç³»ç»Ÿæ£€æŸ¥
- æ›´ç®€æ´ï¼Œé¿å…é‡å¤é€»è¾‘

**é¢„æœŸæ•ˆæœ**:
- âœ… èŠ‚çœ 10-50ç§’åˆå§‹åŒ–æ—¶é—´
- âœ… ä»£ç æ›´ç®€æ´ï¼Œé€»è¾‘æ›´æ¸…æ™°
- âš ï¸ éœ€è¦ç¡®ä¿ app.ts çš„æ£€æµ‹è¶³å¤Ÿå¯é 

**å®æ–½å·¥ä½œé‡**: 1-2å°æ—¶

---

### ä¸­ä¼˜å…ˆçº§ï¼ˆ1-2å‘¨å†…ï¼‰

#### å»ºè®®4: å®ç°å¹¶è¡Œç½‘ç»œæ£€æµ‹

**é—®é¢˜**: å½“å‰æ£€æµ‹æ˜¯ä¸²è¡Œçš„ï¼Œç½‘å¡ â†’ DNS â†’ API Serverï¼Œå¤±è´¥ä¸€ä¸ªå°±è¦ç­‰5ç§’

**æ–¹æ¡ˆ**:
```typescript
private async waitForNetworkReady(maxWaitTime: number = 30000): Promise<boolean> {
  const startTime = Date.now();
  const checkInterval = 5000;

  logger.info('[APP] Waiting for network ready...');

  while (Date.now() - startTime < maxWaitTime) {
    try {
      // âœ… å¹¶è¡Œæ‰§è¡Œä¸‰ä¸ªæ£€æŸ¥
      const [hasAdapter, dnsWorks, apiReachable] = await Promise.all([
        this.checkNetworkAdapter(),
        this.checkDNS(),
        this.checkAPIServer()
      ]);

      // è¯„ä¼°ç½‘ç»œçŠ¶æ€
      if (hasAdapter && dnsWorks && apiReachable) {
        logger.info('[APP] Network is fully ready!');
        return true;
      } else if (hasAdapter && dnsWorks) {
        logger.warn('[APP] Network ready but API server unreachable, proceeding anyway');
        return true; // ç½‘ç»œå°±ç»ªï¼ŒAPIæœåŠ¡å™¨å¯ä»¥ç¨åè¿æ¥
      } else if (hasAdapter) {
        logger.debug('[APP] Network adapter active but DNS/API check failed, retrying...');
      } else {
        logger.debug('[APP] No active network adapter, waiting...');
      }

      await this.sleep(checkInterval);
    } catch (error) {
      logger.debug(`[APP] Network check failed: ${error}, retrying...`);
      await this.sleep(checkInterval);
    }
  }

  logger.warn('[APP] Network ready timeout, proceeding anyway...');
  return false;
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… æ£€æµ‹é€Ÿåº¦æå‡ 3å€ï¼ˆä¸²è¡Œ15ç§’ â†’ å¹¶è¡Œ5ç§’ï¼‰
- âœ… æ›´å¿«å‘ç°ç½‘ç»œå°±ç»ª
- âœ… é™ä½å¹³å‡ç­‰å¾…æ—¶é—´

**å®æ–½å·¥ä½œé‡**: 2-3å°æ—¶

---

#### å»ºè®®5: ä¼˜åŒ–DNSæ£€æµ‹åŸŸå

**é—®é¢˜**: `www.google.com` åœ¨ä¸­å›½å¤§é™†å¯èƒ½è¢«å¢™æˆ–è§£ææ…¢

**æ–¹æ¡ˆ**:
```typescript
private async checkDNS(): Promise<boolean> {
  try {
    const dns = await import('dns');
    const { promisify } = await import('util');
    const lookup = promisify(dns.lookup);

    // âœ… ä½¿ç”¨å¤šä¸ªå¤‡é€‰åŸŸåï¼ŒåŒ…æ‹¬å›½å†…å’Œå›½é™…
    const testDomains = [
      'www.baidu.com',      // ä¸­å›½å¤§é™†
      'www.taobao.com',     // ä¸­å›½å¤§é™†
      'www.cloudflare.com', // å›½é™…
      '1.1.1.1'             // Cloudflare DNSï¼ˆçº¯IPï¼Œå¿…å®šæˆåŠŸï¼‰
    ];

    // å¹¶è¡Œæµ‹è¯•ï¼Œä»»æ„ä¸€ä¸ªæˆåŠŸå³å¯
    const results = await Promise.allSettled(
      testDomains.map(domain => lookup(domain))
    );

    const anySuccess = results.some(result => result.status === 'fulfilled');

    if (anySuccess) {
      logger.debug('[APP] DNS resolution working');
      return true;
    } else {
      logger.debug('[APP] All DNS tests failed');
      return false;
    }
  } catch (error) {
    logger.debug(`[APP] DNS resolution failed: ${error}`);
    return false;
  }
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… æé«˜DNSæ£€æµ‹æˆåŠŸç‡
- âœ… å‡å°‘å› DNSè¢«å¢™å¯¼è‡´çš„è¯¯åˆ¤
- âœ… æ›´å¿«å®Œæˆæ£€æµ‹ï¼ˆå¹¶è¡Œï¼‰

**å®æ–½å·¥ä½œé‡**: 1å°æ—¶

---

#### å»ºè®®6: APIæœåŠ¡å™¨æ£€æµ‹ä¼˜åŒ–

**é—®é¢˜**: APIæœåŠ¡å™¨æœªå¯åŠ¨æ—¶ï¼Œæ¯æ¬¡æ£€æµ‹ç­‰å¾…5ç§’è¶…æ—¶

**æ–¹æ¡ˆA: é™ä½è¶…æ—¶æ—¶é—´**
```typescript
private async checkAPIServer(): Promise<boolean> {
  try {
    // ...
    return new Promise<boolean>((resolve) => {
      const timeout = 2000; // 5ç§’ â†’ 2ç§’
      // ...
    });
  }
}
```

**æ–¹æ¡ˆB: æ™ºèƒ½è·³è¿‡**
```typescript
// åœ¨å¼€å‘ç¯å¢ƒï¼Œå¦‚æœAPIæœåŠ¡å™¨è¿ç»­å¤±è´¥3æ¬¡ï¼Œè‡ªåŠ¨è·³è¿‡åç»­æ£€æµ‹
private apiServerCheckFailures = 0;

private async checkAPIServer(): Promise<boolean> {
  // å¦‚æœå·²çŸ¥APIæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¿«é€Ÿè¿”å›false
  if (this.apiServerCheckFailures >= 3) {
    logger.debug('[APP] Skipping API server check (known unavailable)');
    return false;
  }

  const result = await this._checkAPIServerActual();
  if (!result) {
    this.apiServerCheckFailures++;
  } else {
    this.apiServerCheckFailures = 0; // é‡ç½®è®¡æ•°å™¨
  }

  return result;
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… å‡å°‘æ— è°“çš„ç­‰å¾…æ—¶é—´
- âœ… å¼€å‘ç¯å¢ƒå¯åŠ¨æ›´å¿«

**å®æ–½å·¥ä½œé‡**: 1-2å°æ—¶

---

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰

#### å»ºè®®7: å®ç°åå°åˆå§‹åŒ–

**ç›®æ ‡**: å…è®¸ç”¨æˆ·åœ¨åˆå§‹åŒ–æœªå®Œæˆæ—¶è®¿é—®éƒ¨åˆ†åŠŸèƒ½

**æ–¹æ¡ˆ**:
```typescript
async start(): Promise<void> {
  this.setState(AppState.STARTING);

  // å¿«é€Ÿå¯åŠ¨UIï¼Œæ˜¾ç¤ºéƒ¨åˆ†åŠŸèƒ½
  this.setState(AppState.PARTIAL_READY);
  this.emit('partial-ready');

  // åå°ç»§ç»­åˆå§‹åŒ–
  this.initializeInBackground();
}

private async initializeInBackground(): Promise<void> {
  try {
    // éé˜»å¡çš„åˆå§‹åŒ–
    await this.waitForNetworkReady(30000);
    // ...
    this.setState(AppState.RUNNING);
    this.emit('fully-ready');
  } catch (error) {
    // ...
  }
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… ç”¨æˆ·æ„ŸçŸ¥å¯åŠ¨æ›´å¿«
- âœ… å¯ä»¥å…ˆæŸ¥çœ‹è®¾ç½®ç­‰ç¦»çº¿åŠŸèƒ½
- âš ï¸ éœ€è¦å¤„ç†éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨çš„UIçŠ¶æ€

**å®æ–½å·¥ä½œé‡**: 1-2å¤©

---

#### å»ºè®®8: å®ç°ç¦»çº¿æ¨¡å¼

**ç›®æ ‡**: åœ¨ç½‘ç»œä¸å¯ç”¨æ—¶ä»ç„¶èƒ½ä½¿ç”¨åŸºæœ¬åŠŸèƒ½

**æ–¹æ¡ˆ**:
```typescript
// æ£€æµ‹åˆ°ç½‘ç»œä¸å¯ç”¨æ—¶
if (!networkReady) {
  logger.warn('[APP] Network not ready, entering offline mode');
  this.setState(AppState.OFFLINE_MODE);

  // ä»ç„¶åˆå§‹åŒ–æœ¬åœ°åŠŸèƒ½
  await this.initializePlatform();
  await this.initializeLocalServices(); // åªåˆå§‹åŒ–æœ¬åœ°æœåŠ¡

  // åå°æŒç»­å°è¯•è¿æ¥
  this.startNetworkRecovery();
}
```

**å¯ç”¨åŠŸèƒ½**:
- âœ… æŸ¥çœ‹å’Œä¿®æ”¹è®¾ç½®
- âœ… æŸ¥çœ‹æœ¬åœ°æ—¥å¿—
- âœ… å¯¼å‡ºæ•°æ®
- âŒ å®æ—¶ç›‘æ§ï¼ˆéœ€è¦ç½‘ç»œï¼‰
- âŒ æ•°æ®ä¸Šä¼ ï¼ˆéœ€è¦ç½‘ç»œï¼‰

**é¢„æœŸæ•ˆæœ**:
- âœ… å³ä½¿ç½‘ç»œä¸å¯ç”¨ï¼Œåº”ç”¨ä¹Ÿèƒ½å¯åŠ¨
- âœ… ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡

**å®æ–½å·¥ä½œé‡**: 2-3å¤©

---

#### å»ºè®®9: çŠ¶æ€æŒä¹…åŒ–ï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰

**ç›®æ ‡**: è®°ä½ç½‘ç»œçŠ¶æ€å’Œé…ç½®ï¼Œå‡å°‘é‡å¤æ£€æµ‹

**æ–¹æ¡ˆ**:
```typescript
// ä¿å­˜ç½‘ç»œæ£€æµ‹ç»“æœ
localStorage.setItem('network-check-result', JSON.stringify({
  ready: true,
  checkedAt: Date.now(),
  adapterInfo: { name: 'en0', ip: '192.168.1.100' },
  dnsWorking: true,
  apiReachable: true
}));

// å¯åŠ¨æ—¶å…ˆè¯»å–ç¼“å­˜
const cached = JSON.parse(localStorage.getItem('network-check-result') || '{}');
if (cached.checkedAt && Date.now() - cached.checkedAt < 300000) { // 5åˆ†é’Ÿå†…æœ‰æ•ˆ
  logger.info('[APP] Using cached network check result');
  // è·³è¿‡æ£€æµ‹æˆ–å¿«é€ŸéªŒè¯
}
```

**é¢„æœŸæ•ˆæœ**:
- âœ… äºŒæ¬¡å¯åŠ¨æ›´å¿«
- âœ… å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œæ£€æµ‹

**å®æ–½å·¥ä½œé‡**: 1å¤©

---

## æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

| é¡¹ç›® | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | å»ºè®®è¡ŒåŠ¨ | é¢„æœŸæ”¶ç›Š |
|------|---------|---------|---------|---------|
| **ç¼ºå°‘è¿›åº¦æç¤º** | ğŸ”´ é«˜ | ç”¨æˆ·ä½“éªŒ | ç«‹å³å®æ–½å»ºè®®2 | ç”¨æˆ·æ»¡æ„åº¦â†‘30% |
| **é‡å¤ç½‘ç»œæ£€æµ‹** | ğŸŸ¡ ä¸­ | æ€§èƒ½ | 1å‘¨å†…å®æ–½å»ºè®®3 | å¯åŠ¨æ—¶é—´â†“20-40ç§’ |
| **è¿‡é•¿çš„è¶…æ—¶æ—¶é—´** | ğŸŸ¡ ä¸­ | æ€§èƒ½ | 1å‘¨å†…å®æ–½å»ºè®®1 | æœ€åæƒ…å†µâ†“60% |
| **ä¸²è¡Œç½‘ç»œæ£€æµ‹** | ğŸŸ¡ ä¸­ | æ€§èƒ½ | 2å‘¨å†…å®æ–½å»ºè®®4 | æ£€æµ‹é€Ÿåº¦â†‘3å€ |
| **DNSåŸŸåé€‰æ‹©ä¸å½“** | ğŸŸ¢ ä½ | å¯é æ€§ | 2å‘¨å†…å®æ–½å»ºè®®5 | æˆåŠŸç‡â†‘5% |
| **ç¼ºå°‘ç¦»çº¿æ¨¡å¼** | ğŸŸ¢ ä½ | åŠŸèƒ½ | é•¿æœŸè§„åˆ’ | è¦†ç›–ç‰¹æ®Šåœºæ™¯ |

---

## æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½ï¼ˆv1.0.11-1.0.12ï¼‰

| åœºæ™¯ | å¹³å‡è€—æ—¶ | P95è€—æ—¶ | æœ€åæƒ…å†µ |
|-----|---------|---------|---------|
| ç†æƒ³ç½‘ç»œ | 5-11ç§’ | 15ç§’ | 20ç§’ |
| æ­£å¸¸ä¼ä¸šç½‘ç»œ | 18-42ç§’ | 60ç§’ | 90ç§’ |
| æ…¢é€Ÿç½‘ç»œ | 57-105ç§’ | 120ç§’ | 170ç§’ |

### ä¼˜åŒ–åé¢„æœŸæ€§èƒ½ï¼ˆå®æ–½å»ºè®®1-6ï¼‰

| åœºæ™¯ | å¹³å‡è€—æ—¶ | P95è€—æ—¶ | æœ€åæƒ…å†µ | æ”¹å–„å¹…åº¦ |
|-----|---------|---------|---------|---------|
| ç†æƒ³ç½‘ç»œ | 3-8ç§’ | 10ç§’ | 15ç§’ | â†“30% |
| æ­£å¸¸ä¼ä¸šç½‘ç»œ | 10-25ç§’ | 35ç§’ | 50ç§’ | â†“40% |
| æ…¢é€Ÿç½‘ç»œ | 25-60ç§’ | 70ç§’ | 90ç§’ | â†“50% |

---

## å®æ–½è·¯çº¿å›¾

### ç¬¬1å‘¨ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
- âœ… Day 1-2: å®æ–½å»ºè®®1ï¼ˆä¼˜åŒ–è¶…æ—¶æ—¶é—´ï¼‰
- âœ… Day 3-4: å®æ–½å»ºè®®2ï¼ˆè¿›åº¦æç¤ºï¼‰
- âœ… Day 5: å®æ–½å»ºè®®3ï¼ˆæ¶ˆé™¤é‡å¤æ£€æµ‹ï¼‰

**é¢„æœŸæˆæœ**: åˆå§‹åŒ–æ—¶é—´å‡å°‘30-40%ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„

### ç¬¬2å‘¨ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- âœ… Day 1-2: å®æ–½å»ºè®®4ï¼ˆå¹¶è¡Œæ£€æµ‹ï¼‰
- âœ… Day 3: å®æ–½å»ºè®®5ï¼ˆDNSä¼˜åŒ–ï¼‰
- âœ… Day 4: å®æ–½å»ºè®®6ï¼ˆAPIæ£€æµ‹ä¼˜åŒ–ï¼‰
- âœ… Day 5: æµ‹è¯•å’Œè°ƒä¼˜

**é¢„æœŸæˆæœ**: åˆå§‹åŒ–æ—¶é—´å†å‡å°‘20-30%ï¼Œå¯é æ€§æå‡

### ç¬¬3-4å‘¨ï¼ˆä½ä¼˜å…ˆçº§ï¼Œå¯é€‰ï¼‰
- å®æ–½å»ºè®®7ï¼ˆåå°åˆå§‹åŒ–ï¼‰
- å®æ–½å»ºè®®8ï¼ˆç¦»çº¿æ¨¡å¼ï¼‰
- å®æ–½å»ºè®®9ï¼ˆçŠ¶æ€æŒä¹…åŒ–ï¼‰

**é¢„æœŸæˆæœ**: åŠŸèƒ½æ›´å®Œå–„ï¼Œè¦†ç›–æç«¯åœºæ™¯

---

## å­¦ä¹ è¦ç‚¹

### 1. ç”¨æˆ·ä½“éªŒä¸ç³»ç»Ÿç¨³å®šæ€§çš„æƒè¡¡

**æ•™è®­**:
- è¿‡åº¦è¿½æ±‚ç¨³å®šæ€§ï¼ˆè¿æ¥æˆåŠŸç‡85%ï¼‰å¯èƒ½ç‰ºç‰²å“åº”é€Ÿåº¦
- éœ€è¦åœ¨ç¨³å®šæ€§å’Œä½“éªŒä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹
- **å»ºè®®**: ä½¿ç”¨åˆ†å±‚ç­–ç•¥
  - å¿«é€Ÿè·¯å¾„ï¼ˆ10ç§’ï¼‰ï¼šè¦†ç›–80%åœºæ™¯
  - ç¨³å¥è·¯å¾„ï¼ˆ30ç§’ï¼‰ï¼šè¦†ç›–95%åœºæ™¯
  - æé™è·¯å¾„ï¼ˆ60ç§’ï¼‰ï¼šè¦†ç›–99%åœºæ™¯

### 2. è¿›åº¦æç¤ºçš„é‡è¦æ€§

**å¿ƒç†å­¦åŸç†**:
- ç”¨æˆ·ç­‰å¾…æ—¶ï¼Œä¸ç¡®å®šæ€§æ¯”å®é™…æ—¶é•¿æ›´è®©äººç„¦è™‘
- æä¾›è¿›åº¦åé¦ˆå¯ä»¥æå‡2-3å€çš„æ»¡æ„åº¦
- æ¸…æ™°çš„è¿›åº¦æ¡æ¯”æ¨¡ç³Šçš„"åŠ è½½ä¸­"å¥½10å€

**æœ€ä½³å®è·µ**:
- æ˜¾ç¤ºå…·ä½“æ­¥éª¤ï¼ˆ"æ­£åœ¨åˆå§‹åŒ–ç½‘ç»œ..."ï¼‰
- æ˜¾ç¤ºç™¾åˆ†æ¯”è¿›åº¦ï¼ˆ25%, 50%, 75%ï¼‰
- é¢„ä¼°å‰©ä½™æ—¶é—´ï¼ˆ"å¤§çº¦è¿˜éœ€30ç§’"ï¼‰
- å…è®¸å–æ¶ˆæˆ–è·³è¿‡ï¼ˆå¦‚é€‚ç”¨ï¼‰

### 3. ç½‘ç»œæ£€æµ‹çš„æœ€ä½³å®è·µ

**é¿å…çš„é™·é˜±**:
- âŒ ä½¿ç”¨å•ä¸€å¤–éƒ¨åŸŸåï¼ˆå¦‚ google.comï¼‰
- âŒ è¿‡é•¿çš„è¶…æ—¶æ—¶é—´
- âŒ ä¸²è¡Œæ£€æµ‹
- âŒ æ²¡æœ‰ç¼“å­˜æœºåˆ¶

**æ¨èåšæ³•**:
- âœ… ä½¿ç”¨å¤šä¸ªåŸŸåå’ŒIPåœ°å€
- âœ… å¹¶è¡Œæ£€æµ‹ï¼Œä»»æ„æˆåŠŸå³å¯
- âœ… åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆ2-5ç§’ï¼‰
- âœ… æ™ºèƒ½è·³è¿‡å·²çŸ¥å¤±è´¥çš„æ£€æµ‹
- âœ… ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤æ£€æµ‹

### 4. åˆå§‹åŒ–æµç¨‹è®¾è®¡åŸåˆ™

1. **å¿«é€Ÿå¤±è´¥åŸåˆ™**: ä¸è¦è®©ç”¨æˆ·ç­‰å¾…ä¸å¿…è¦çš„è¶…æ—¶
2. **æ¸è¿›å¼åˆå§‹åŒ–**: å…ˆå¯åŠ¨æ ¸å¿ƒåŠŸèƒ½ï¼Œåå°åŠ è½½å…¶ä»–åŠŸèƒ½
3. **é™çº§ç­–ç•¥**: ç½‘ç»œä¸å¯ç”¨æ—¶ä»ç„¶èƒ½æä¾›åŸºæœ¬åŠŸèƒ½
4. **é€æ˜åº¦**: å‘Šè¯‰ç”¨æˆ·åœ¨åšä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæ…¢
5. **å¯ä¸­æ–­æ€§**: å…è®¸ç”¨æˆ·å–æ¶ˆæˆ–è·³è¿‡æŸäº›æ­¥éª¤

---

## å‚è€ƒèµ„æº

### ç›¸å…³ä»£ç æ–‡ä»¶
- `main/app.ts` - åº”ç”¨å¯åŠ¨æµç¨‹
- `common/services/fsm/state-handlers/init-state-handler.ts` - INITçŠ¶æ€å¤„ç†
- `electron/main-minimal.js` - Electronä¸»è¿›ç¨‹ï¼Œè‡ªå¯åŠ¨åŠŸèƒ½
- `electron/renderer/minimal-index.html` - UIç•Œé¢

### ç›¸å…³æ–‡æ¡£
- `doc/å®¢æˆ·ç«¯å…³æœºé‡å¯åè¿æ¥ä¸ç¨³å®šé—®é¢˜åˆ†æ.md` - é—®é¢˜åˆ†ææŠ¥å‘Š
- `doc/å®¢æˆ·ç«¯è¿æ¥ç¨³å®šæ€§æ”¹è¿›å®æ–½æ€»ç»“.md` - æ”¹è¿›å®æ–½æ€»ç»“

### æœ€ä½³å®è·µ
- [Designing for Speed](https://developer.mozilla.org/en-US/docs/Web/Performance/Perceived_performance)
- [User Interface Design Patterns](https://www.nngroup.com/articles/progress-indicators/)
- [Timeout Best Practices](https://nodejs.org/api/timers.html)

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-10-16 17:30:00
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: ä¼˜å…ˆå®æ–½å»ºè®®1å’Œå»ºè®®2ï¼Œé¢„è®¡2-3å¤©å®Œæˆ
