# v1.0.69 Release Notes

**å‘å¸ƒæ—¶é—´**: 2025-11-04
**å…³é”®ä¿®å¤**: WindowsåŸç”Ÿæ¨¡å—é‡æ–°ç¼–è¯‘é—®é¢˜

---

## é—®é¢˜å›é¡¾

### v1.0.56-v1.0.68çš„é—®é¢˜
- ç”¨æˆ·å®‰è£…æœ€æ–°ç‰ˆæœ¬åï¼Œæ—¥å¿—ä»æ˜¾ç¤º `VERSION: UNKNOWN (old version)`
- `getActiveURL method exists: false`
- Windows URLé‡‡é›†åŠŸèƒ½ä¸å¯ç”¨

### æ ¹æœ¬åŸå› 
**WindowsåŸç”Ÿæ¨¡å—ï¼ˆnative-event-monitor-winï¼‰æœªåœ¨CIä¸­é‡æ–°ç¼–è¯‘**

ä¹‹å‰çš„workflowï¼š
```yaml
# âŒ é”™è¯¯åšæ³•
npm run build  # ä½¿ç”¨ node-gypï¼Œä¸é’ˆå¯¹ Electron
```

é—®é¢˜ï¼š
1. `npm run build` ä½¿ç”¨ç³»ç»Ÿçš„ Node.js ç¯å¢ƒç¼–è¯‘
2. ç¼–è¯‘å‡ºçš„ `.node` æ–‡ä»¶ä¸æ˜¯é’ˆå¯¹ Electron çš„ ABI
3. è¿è¡Œæ—¶åŠ è½½å¤±è´¥ï¼Œé™çº§åˆ°å¤‡ç”¨å®ç°
4. å¯¼è‡´ VERSION = "UNKNOWN" ä¸”åŠŸèƒ½ç¼ºå¤±

---

## v1.0.69 ä¿®å¤æ–¹æ¡ˆ

### å…³é”®ä¿®æ”¹

#### 1. Workflowæ”¹è¿› (`.github/workflows/build-and-release.yml`)

**ä¿®æ”¹å‰**:
```yaml
- name: Rebuild native module
  run: |
    cd native-event-monitor-win
    npm install
    npm run build  # âŒ ä½¿ç”¨ node-gyp
```

**ä¿®æ”¹å**:
```yaml
- name: Rebuild native module for Electron
  run: |
    # è·å– Electron ç‰ˆæœ¬
    $electronVersion = (Get-Content "package.json" -Raw | ConvertFrom-Json).devDependencies.electron.TrimStart('^')
    Write-Host "ğŸ¯ Target Electron version: $electronVersion"

    cd native-event-monitor-win

    # æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©
    if (Test-Path "build") {
      Remove-Item "build" -Recurse -Force
    }

    # å®‰è£…ä¾èµ–
    npm install

    # âœ… ä½¿ç”¨ electron-rebuild é’ˆå¯¹ Electron é‡æ–°ç¼–è¯‘
    cd ..
    npx electron-rebuild -f -w native-event-monitor-win

    # éªŒè¯ç¼–è¯‘ç»“æœ
    if (Test-Path "native-event-monitor-win/build/Release/event_monitor.node") {
      $module = Get-Item "native-event-monitor-win/build/Release/event_monitor.node"
      $hash = (Get-FileHash $module.FullName -Algorithm SHA256).Hash
      Write-Host "âœ… åŸç”Ÿæ¨¡å—ç¼–è¯‘æˆåŠŸ"
      Write-Host "   SHA256: $hash"
    } else {
      Write-Host "âŒ åŸç”Ÿæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼"
      exit 1
    }
```

**å…³é”®æ”¹è¿›**:
1. âœ… æ¸…ç†æ—§çš„ `build/` ç›®å½•ï¼Œç¡®ä¿é‡æ–°ç¼–è¯‘
2. âœ… ä½¿ç”¨ `electron-rebuild -f -w native-event-monitor-win`
3. âœ… `-f`: å¼ºåˆ¶é‡æ–°ç¼–è¯‘
4. âœ… `-w`: æŒ‡å®šè¦é‡å»ºçš„æ¨¡å—è·¯å¾„
5. âœ… é’ˆå¯¹é¡¹ç›®çš„ Electron ç‰ˆæœ¬ï¼ˆ28.2.10ï¼‰ç¼–è¯‘
6. âœ… è¾“å‡º SHA256 hash ç”¨äºéªŒè¯

#### 2. åˆ é™¤é¢„ç¼–è¯‘éªŒè¯æ­¥éª¤

ç§»é™¤äº† "Verify precompiled native module" æ­¥éª¤ï¼Œå› ä¸ºï¼š
- ç°åœ¨æ¯æ¬¡æ„å»ºéƒ½é‡æ–°ç¼–è¯‘ï¼Œä¸å†ä¾èµ–é¢„ç¼–è¯‘æ–‡ä»¶
- é¢„ç¼–è¯‘æ–‡ä»¶å¯èƒ½æ˜¯æ—§ç‰ˆæœ¬ï¼Œå¯¼è‡´ä¹‹å‰çš„é—®é¢˜

#### 3. ç‰ˆæœ¬æ ‡è¯†æ›´æ–°

**platforms/windows/windows-adapter.ts**:
```typescript
// ä¿®æ”¹å‰
public readonly VERSION = '1.0.68-with-getActiveURL';

// ä¿®æ”¹å
public readonly VERSION = '1.0.69-with-getActiveURL-native-rebuilt';
```

**package.json**:
```json
{
  "version": "1.0.69"
}
```

---

## æŠ€æœ¯ç»†èŠ‚

### electron-rebuild å·¥ä½œåŸç†

```bash
npx electron-rebuild -f -w native-event-monitor-win
```

1. **è¯»å–é¡¹ç›®çš„ Electron ç‰ˆæœ¬** (`node_modules/electron`)
2. **ç¡®å®š Electron çš„ Node.js ABI** (Electron 28 â†’ ABI ~120)
3. **é‡æ–°ç¼–è¯‘æŒ‡å®šæ¨¡å—** (`-w native-event-monitor-win`)
4. **ç”Ÿæˆé’ˆå¯¹ Electron ABI çš„ .node æ–‡ä»¶**

### ä¸ºä»€ä¹ˆ node-gyp ä¸å¤Ÿç”¨ï¼Ÿ

| æ–¹å¼ | ç¼–è¯‘ç›®æ ‡ | ç»“æœ |
|------|---------|------|
| `node-gyp build` | ç³»ç»Ÿ Node.js (18.20.8) | âŒ Electron æ— æ³•åŠ è½½ |
| `electron-rebuild` | Electron 28 (Node.js 18.18.2 + Electron ABI) | âœ… å®Œç¾å…¼å®¹ |

**å…³é”®åŒºåˆ«**:
- Electron ä½¿ç”¨ Chromium çš„ BoringSSLï¼Œä¸æ˜¯ OpenSSL
- Electron æ¯ä¸ªä¸»ç‰ˆæœ¬æœ‰ç‹¬ç«‹çš„ ABI
- å¿…é¡»é’ˆå¯¹ Electron çš„ç‰¹å®š ABI ç¼–è¯‘

---

## éªŒè¯æ­¥éª¤

### CI éªŒè¯ï¼ˆè‡ªåŠ¨ï¼‰
1. âœ… æ¸…ç†æ—§æ„å»ºç›®å½•
2. âœ… ä½¿ç”¨ electron-rebuild ç¼–è¯‘
3. âœ… éªŒè¯ `.node` æ–‡ä»¶å­˜åœ¨
4. âœ… è¾“å‡º SHA256 hash
5. âœ… ç¼–è¯‘ TypeScript
6. âœ… æ‰“åŒ… NSIS å®‰è£…åŒ…
7. âœ… éªŒè¯å®‰è£…åŒ…åŒ…å« getActiveURL

### ç”¨æˆ·éªŒè¯ï¼ˆæ‰‹åŠ¨ï¼‰
ç”¨æˆ·ä¸‹è½½ v1.0.69 åï¼Œæ—¥å¿—åº”æ˜¾ç¤ºï¼š

```
âœ… é¢„æœŸè¾“å‡º:
Platform adapter version: 1.0.69-with-getActiveURL-native-rebuilt
getActiveURL method exists: true
[Windows] Starting URL collection for browser: chrome
[Windows] Active URL: https://example.com
```

---

## é¢„æœŸæ”¹è¿›

### v1.0.56-v1.0.68 (æ—§ç‰ˆæœ¬)
```
âŒ Platform adapter version: UNKNOWN (old version)
âŒ getActiveURL method exists: false
âŒ Failed to get URL from platform adapter
```

### v1.0.69 (æœ¬ç‰ˆæœ¬)
```
âœ… Platform adapter version: 1.0.69-with-getActiveURL-native-rebuilt
âœ… getActiveURL method exists: true
âœ… Successfully collected browser URL
```

---

## éƒ¨ç½²æ¸…å•

- [x] ä¿®æ”¹ `.github/workflows/build-and-release.yml`
- [x] æ›´æ–° `package.json` ç‰ˆæœ¬åˆ° 1.0.69
- [x] æ›´æ–° `WindowsAdapter.VERSION` æ ‡è¯†
- [x] åˆ é™¤é¢„ç¼–è¯‘éªŒè¯æ­¥éª¤
- [x] æ·»åŠ  electron-rebuild æ­¥éª¤
- [ ] æ¨é€ä»£ç åˆ° GitHub
- [ ] åˆ›å»º v1.0.69 tag
- [ ] è§¦å‘ GitHub Actions æ„å»º
- [ ] éªŒè¯æ„å»ºæ—¥å¿—ï¼ˆnative module ç¼–è¯‘æˆåŠŸï¼‰
- [ ] ä¸‹è½½å®‰è£…åŒ…æµ‹è¯•
- [ ] ç¡®è®¤ç”¨æˆ·åé¦ˆ

---

## å›æ»šè®¡åˆ’

å¦‚æœ v1.0.69 ä»æœ‰é—®é¢˜ï¼š

1. **æ£€æŸ¥æ„å»ºæ—¥å¿—**
   - ç¡®è®¤ electron-rebuild æ­¥éª¤æˆåŠŸ
   - ç¡®è®¤ SHA256 hash è¾“å‡º
   - ç¡®è®¤ `.node` æ–‡ä»¶è¢«æ‰“åŒ…åˆ° NSIS

2. **æœ¬åœ°æµ‹è¯•**
   ```bash
   cd native-event-monitor-win
   npm install
   cd ..
   npx electron-rebuild -f -w native-event-monitor-win
   npm run electron
   ```

3. **åº”æ€¥æ–¹æ¡ˆ**
   - å¦‚æœ electron-rebuild å¤±è´¥ï¼Œå¯èƒ½éœ€è¦åœ¨ Windows è™šæ‹Ÿæœºä¸Šæœ¬åœ°ç¼–è¯‘
   - æäº¤ç¼–è¯‘å¥½çš„ `.node` æ–‡ä»¶åˆ°ä»“åº“ä½œä¸º fallback

---

## ç»éªŒæ•™è®­

1. **åŸç”Ÿæ¨¡å—å¿…é¡»é’ˆå¯¹ Electron ABI ç¼–è¯‘**
   - ä¸èƒ½ä½¿ç”¨ç³»ç»Ÿ Node.js ç¼–è¯‘
   - å¿…é¡»ä½¿ç”¨ electron-rebuild

2. **é¢„ç¼–è¯‘æ–‡ä»¶å¯èƒ½å¯¼è‡´ç‰ˆæœ¬ä¸ä¸€è‡´**
   - CI åº”è¯¥æ¯æ¬¡é‡æ–°ç¼–è¯‘
   - ä¸è¦ä¾èµ–ä»“åº“ä¸­çš„é¢„ç¼–è¯‘æ–‡ä»¶

3. **éªŒè¯ä¸å¤Ÿå…¨é¢**
   - ä¹‹å‰åªéªŒè¯äº† TypeScript ä»£ç 
   - åº”è¯¥éªŒè¯åŸç”Ÿæ¨¡å—çš„ç¼–è¯‘å’Œæ‰“åŒ…

4. **macOS å’Œ Windows æ„å»ºå‘½ä»¤åº”ä¸€è‡´**
   - macOS ä½¿ç”¨ electron-rebuild âœ…
   - Windows ä¹‹å‰ä½¿ç”¨ node-gyp âŒ
   - ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ electron-rebuild âœ…

---

**å‘å¸ƒè´Ÿè´£äºº**: Claude Code
**é¢„è®¡æ„å»ºæ—¶é—´**: 15-20 åˆ†é’Ÿ
**é£é™©ç­‰çº§**: ä½ï¼ˆä»…ä¿®æ”¹ç¼–è¯‘æµç¨‹ï¼‰
