================================================================
✅ 问题已修复！下一步操作指南
================================================================

问题原因：
  PlatformAdapterBridge（桥接器）未转发 getActiveURL 方法

修复文件：
  main/platform-adapter-bridge.ts (已修改完成)

================================================================
立即执行的3个步骤
================================================================

步骤1：重新构建 Windows 客户端
-------------------------------
使用命令：
  /build-windows

这将触发 GitHub Actions 自动构建，包括：
  - 清理所有缓存
  - 重新编译 TypeScript
  - 验证 getActiveURL 存在
  - 打包 NSIS 安装程序
  - 上传到 GitHub Releases

等待时间：约 15-20 分钟

步骤2：完全卸载旧版本
-------------------------------
打开 PowerShell（管理员），执行：

  # 停止应用
  taskkill /F /IM EmployeeSafety.exe

  # 删除应用目录
  Remove-Item "$env:LOCALAPPDATA\Programs\EmployeeSafety" -Recurse -Force

  # 删除配置和日志
  Remove-Item "$env:APPDATA\employee-monitor" -Recurse -Force

  # 重启计算机（清除所有缓存）
  Restart-Computer

步骤3：安装新版本并验证
-------------------------------
1. 从 GitHub Releases 下载最新安装包
   https://github.com/zhangxiaoyu2000/employee-s/releases/latest

2. 右键 -> "以管理员身份运行" 安装

3. 启动应用，等待 30 秒

4. 运行诊断脚本验证：
   cd C:\path\to\employee-client\claudedocs
   .\verify-installed-version.ps1

================================================================
预期结果
================================================================

诊断脚本应该显示：
  [OK] WindowsAdapter VERSION: 1.0.78-with-url-collection (或更高)
  [OK] getActiveURL method EXISTS
  [OK] PlatformAdapterBridge includes getActiveURL forwarding  ← 新增！

运行时日志应该显示：
  [URLCollector] Platform adapter version: 1.0.78-with-url-collection
  [URLCollector] getActiveURL method exists: true
  [PLATFORM_BRIDGE] 获取浏览器URL请求: Chrome
  [PLATFORM_BRIDGE] ✅ 成功获取URL: https://example.com

如果看到以上内容 → ✅ 修复成功！

================================================================
技术细节
================================================================

问题根源：
  应用使用 PlatformAdapterBridge 包装 WindowsAdapter
  但桥接器只转发明确定义的方法
  getActiveURL 不在转发列表中
  → 运行时无法访问，即使方法存在于代码中

修复方式：
  在 PlatformAdapterBridge 中添加 getActiveURL 转发方法
  现在方法调用链完整：
    URLCollectorService
      → PlatformAdapterBridge.getActiveURL() [新增]
      → WindowsAdapter.getActiveURL()
      → WindowsURLCollector.getActiveURL()
      → ✅ 成功

影响范围：
  ✅ URL 采集功能：修复后将正常工作
  ✅ 其他功能：不受影响（截图、活动监控等）

================================================================
如果问题仍然存在
================================================================

请收集以下信息并提交 Issue：

1. 诊断脚本完整输出：
   .\verify-installed-version.ps1 > diagnostic-output.txt

2. 运行时日志：
   %APPDATA%\employee-monitor\logs\*.log

3. 应用版本信息：
   - 下载的安装包文件名
   - GitHub Release 版本号
   - 安装时间

提交到：
  https://github.com/zhangxiaoyu2000/employee-s/issues

================================================================
